<div class="container mt-5">
  <div class="row justify-content-center">
    <!-- ÊäïÁ®øË©≥Á¥∞ -->
    <div class="col-md-7">
      <div class="card shadow-sm mb-4">
        <!-- ÊäïÁ®øËÄÖÊÉÖÂ†± -->
        <div class="card-header d-flex align-items-center">
          <%= link_to image_tag(
              @post.user.avatar.attached? ? @post.user.avatar : "no_image.jpg",
              class: "rounded-circle me-3 border", size: "50x50"),
              @post.user == current_user ? mypage_path : user_path(@post.user) %>
          <div>
            <h5 class="mb-0">
              <%= link_to @post.user.name,
                          @post.user == current_user ? mypage_path : user_path(@post.user),
                          class: "text-decoration-none text-dark" %>
            </h5>
            <small class="text-muted">ÊäïÁ®øÊó•: <%= @post.created_at.in_time_zone("Asia/Tokyo").strftime("%Y-%m-%d %H:%M") %></small>
          </div>
        </div>

        <!-- ÊäïÁ®øÂÜÖÂÆπ -->
        <div class="card-body">
          <p class="mb-4"><%= simple_format(@post.content) %></p>
        </div>

        <!-- „Ç≥„É°„É≥„ÉàÊï∞„Å®„ÅÑ„ÅÑ„Å≠ -->
        <div class="card-footer d-flex align-items-center">
          <!-- „Ç≥„É°„É≥„ÉàÊï∞ -->
          <div class="d-flex align-items-center mr-5">
            <span class="me-1">üí¨</span>
            <span class="text-muted"><%= @post.post_comments.count %></span>
          </div>

          <!-- „ÅÑ„ÅÑ„Å≠ -->
          <div class="d-flex align-items-center">
            <% if current_user.favorites.exists?(post_id: @post.id) %>
              <!-- „ÅÑ„ÅÑ„Å≠Ê∏à„ÅøÔºàÂèñ„ÇäÊ∂à„Åó„É™„É≥„ÇØÔºâ -->
              <%= link_to '‚ù§Ô∏è', favorite_path(@post.favorites.find_by(user_id: current_user.id)), 
                          method: :delete, 
                          remote: true, 
                          class: "text-danger favorite-post-id-" + @post.id.to_s, 
                          data: { id: @post.id } %>
            <% else %>
              <!-- „ÅÑ„ÅÑ„Å≠„Åó„Å¶„ÅÑ„Å™„ÅÑÔºàËøΩÂä†„É™„É≥„ÇØÔºâ -->
              <%= link_to 'ü§ç', favorites_path(post_id: @post.id), 
                          method: :post, 
                          remote: true, 
                          class: "text-dark favorite-post-id-" + @post.id.to_s, 
                          data: { id: @post.id } %>
            <% end %>
            <span class="ms-1 favorite-count-post-id-<%= @post.id %>"><%= @post.favorites.count %></span>
          </div>
        </div>
      </div>

      <!-- „Ç≥„É°„É≥„Éà„Éï„Ç©„Éº„É† -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="mb-3">„Ç≥„É°„É≥„Éà„ÇíÊäïÁ®ø„Åô„Çã</h5>
          <div class="d-flex align-items-start">
            <%= image_tag current_user.avatar.attached? ? current_user.avatar : "no_image.jpg",
                          class: "rounded-circle me-3 border", size: "50x50" %>
            <%= form_with model: [@post, @comment], local: true, class: "w-100" do |f| %>
              <div class="form-floating mb-3">
                <%= f.text_area :content, class: "form-control", rows: 2, placeholder: "„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ", id: "commentContent" %>
              </div>
              <div class="text-end">
                <%= f.submit "„Ç≥„É°„É≥„Éà„ÇíÊäïÁ®ø", class: "btn btn-primary btn-sm" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
    <div class="col-md-5">
      <div class="card shadow-sm">
        <div class="card-header">
          <h5 class="mb-0">„Ç≥„É°„É≥„Éà‰∏ÄË¶ß</h5>
        </div>
        <div class="card-body">
          <% if @post.post_comments.any? %>
            <% @post.post_comments.each do |comment| %>
              <div class="card mb-3">
                <div class="card-body">
                  <div class="d-flex align-items-start">
                    <%= image_tag comment.user.avatar.attached? ? comment.user.avatar : "no_image.jpg",
                                  class: "rounded-circle me-3 border", size: "40x40" %>
                    <div class="flex-grow-1">
                      <div class="d-flex justify-content-between align-items-center">
                        <strong>
                          <%= link_to comment.user.name, user_path(comment.user), class: "text-decoration-none text-dark" %>
                        </strong>
                        <% if comment.user == current_user %>
                          <div class="d-flex gap-1">
                            <%= link_to "Á∑®ÈõÜ", edit_post_post_comment_path(@post, comment),
                                        class: "btn btn-sm btn-outline-primary mr-2" %>
                            <%= link_to "ÂâäÈô§", post_post_comment_path(@post, comment),
                                        method: :delete,
                                        data: { confirm: "„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" },
                                        class: "btn btn-sm btn-outline-danger" %>
                          </div>
                        <% end %>
                      </div>
                      <p class="mb-1"><%= comment.content %></p>
                      <small class="text-muted"><%= time_ago_in_words(comment.created_at) %> ago</small>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted">„Åæ„Å†„Ç≥„É°„É≥„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
