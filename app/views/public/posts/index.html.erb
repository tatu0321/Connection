<div class="container-fluid my-5">
  <!-- ÊäïÁ®ø‰∏ÄË¶ß„Éö„Éº„Ç∏„ÅÆ„Çø„Ç§„Éà„É´ -->
  <h3 class="text-center mb-4">ÊäïÁ®ø‰∏ÄË¶ß</h3>
  <p class="text-center mb-4">„Åì„Åì„Åß„ÅØ„Åô„Åπ„Å¶„ÅÆÊäïÁ®ø„ÇíÈñ≤Ë¶ß„Åß„Åç„Åæ„Åô„ÄÇ</p>

  <div class="row">
    <!-- „Ç∏„É£„É≥„É´Áµû„ÇäËæº„Åø„Éï„Ç©„Éº„É†ÔºàÂ∑¶ÂÅ¥Ôºâ -->
    <div class="col-sm-3 col-md-3 col-lg-3 ml-5">
      <%= render "filter_form" %>
    </div>

    <!-- ÊäïÁ®ø‰∏ÄË¶ßÔºàÂè≥ÂÅ¥Ôºâ -->
    <div class="col-sm-3 col-md-5 col-lg-8">
      <% if @posts.any? %>
        <% @posts.each do |post| %>
          <div class="card mb-4 shadow-sm" style="cursor: pointer;">
            <!-- „Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„Éº -->
            <div class="card-header d-flex align-items-center" data-id="<%= post.id %>">
              <!-- „Ç¢„Éê„Çø„ÉºÔºàÊäïÁ®øËÄÖÊÉÖÂ†±„Éö„Éº„Ç∏„É™„É≥„ÇØÔºâ -->
              <%= link_to image_tag(post.user.avatar.attached? ? post.user.avatar : 'no_image.jpg',
                                    class: 'rounded-circle me-3', size: '40x40'),
                          post.user == current_user ? mypage_path : user_path(post.user),
                          class: "text-decoration-none",
                          onclick: "event.stopPropagation();" %>
              <div>
                <!-- ÊäïÁ®øËÄÖÂêçÔºàÊäïÁ®øËÄÖÊÉÖÂ†±„Éö„Éº„Ç∏„É™„É≥„ÇØÔºâ -->
                <h5 class="mb-0">
                  <%= link_to post.user.name, post.user == current_user ? mypage_path : user_path(post.user),
                              class: "text-decoration-none text-dark",
                              onclick: "event.stopPropagation();" %>
                </h5>
                <!-- ÊäïÁ®øÊó• -->
                <small class="text-muted">ÊäïÁ®øÊó•ÊôÇ: <%= post.created_at.in_time_zone("Asia/Tokyo").strftime("%Y-%m-%d %H:%M") %></small>
              </div>
            </div>

            <!-- „Ç´„Éº„ÉâÊú¨Êñá -->
            <div class="card-body" data-id="<%= post.id %>">
              <!-- ÊäïÁ®øÂÜÖÂÆπÔºà„ÇØ„É™„ÉÉ„ÇØ„ÅßÊäïÁ®øË©≥Á¥∞Ôºâ -->
              <!-- „Ç∏„É£„É≥„É´Ë°®Á§∫ -->
              <div class="mt-2 mb-2">
                <% if post.genre.present? %>
                  <span class="badge" style="background-color: <%= post.genre.color %>;">
                    <%= post.genre.name %>
                  </span>
                <% end %>
              </div>
              <p class="mb-0">
                <%= truncate(post.content, length: 100) %>
              </p>
            </div>

            <!-- „Ç´„Éº„Éâ„Éï„ÉÉ„Çø„Éº -->
            <div class="card-footer text-muted d-flex align-items-center">
              <!-- „Ç≥„É°„É≥„ÉàÊï∞ -->
              <div class="d-flex align-items-center mr-5">
                <span class="me-1">üí¨</span>
                <%= post.post_comments.count %>
              </div>
              <div class="d-flex align-items-center">
                <% if current_user.favorites.exists?(post_id: post.id) %>
                  <!-- „ÅÑ„ÅÑ„Å≠Ê∏à„ÅøÔºàÂèñ„ÇäÊ∂à„Åó„É™„É≥„ÇØÔºâ -->
                  <%= link_to '‚ù§Ô∏è', favorite_path(post.favorites.find_by(user_id: current_user.id)),
                              method: :delete, 
                              remote: true, 
                              class: "text-danger favorite-post-id-" + post.id.to_s, 
                              data: { id: post.id } %>
                <% else %>
                  <!-- „ÅÑ„ÅÑ„Å≠„Åó„Å¶„ÅÑ„Å™„ÅÑÔºàËøΩÂä†„É™„É≥„ÇØÔºâ -->
                  <%= link_to 'ü§ç', favorites_path(post_id: post.id), 
                              method: :post, 
                              remote: true, 
                              class: "text-dark favorite-post-id-" + post.id.to_s, 
                              data: { id: post.id } %>
                <% end %>
                <span class="favorite-count-post-id-<%= post.id %>"><%= post.favorites.count %></span>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <!-- ÊäïÁ®ø„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà -->
        <div class="alert alert-info text-center">
          „Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  $(".card-header, .card-body").on('click', function() {
    const id = $(this).data('id');
    location.href = `/posts/${id}`;
  });
</script>